<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>打擊率排行榜</title>
</head>
<body>
    <h1>2025 年打擊率排行榜（Top 5）</h1>

    <h2>結果：</h2>
    <div id="result"></div>

    <script>
        async function loadRanking() {
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = "<p>載入中...</p>";

            try {
                const res = await fetch("http://127.0.0.1:5000/ranking/avg", {
                    method: "GET"
                });

                const data = await res.json();

                if (data.success) {
                    const list = data.result;

                    if (list.length === 0) {
                        resultDiv.innerHTML = "<p>沒有符合條件的球員</p>";
                    } else {
                        const table = document.createElement("table");
                        table.border = "1";
                        table.cellPadding = "8";

                        table.innerHTML = `
                            <tr>
                                <th>名次</th>
                                <th>球員</th>
                                <th>球隊</th>
                                <th>安打</th>
                                <th>打數</th>
                                <th>打擊率</th>
                            </tr>
                        `;

                        list.forEach(row => {
                            const tr = document.createElement("tr");
                            tr.innerHTML = `
                                <td>${row.rank}</td>
                                <td>${row.player_name}</td>
                                <td>${row.team_name}</td>
                                <td>${row.total_hits}</td>
                                <td>${row.total_at_bats}</td>
                                <td>${row.avg}</td>
                            `;
                            table.appendChild(tr);
                        });

                        resultDiv.innerHTML = "";
                        resultDiv.appendChild(table);
                    }
                } else {
                    resultDiv.innerHTML = "<p>查詢失敗：" + data.error + "</p>";
                }

            } catch (err) {
                resultDiv.innerHTML = "<p>發生錯誤：" + err + "</p>";
            }
        }

        // 一打開網頁就載入排行榜
        window.onload = loadRanking;
    </script>
</body>
</html>