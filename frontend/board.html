<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>棒球排行榜</title>
</head>
<body>
    <h1>棒球排行榜</h1>

    <label for="rankingType">選擇排行榜：</label>
    <select id="rankingType" onchange="loadRanking()">
        <option value="avg">打擊率 AVG</option>
        <option value="era">防禦率 ERA</option>
        <option value="hr">全壘打 HR</option>
    </select>

    <h2>排行結果：</h2>
    <div id="result"></div>

    <script>
        async function loadRanking() {
            const type = document.getElementById("rankingType").value;
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = "";

            try {
                const res = await fetch(`http://127.0.0.1:5000/ranking/${type}`);
                const data = await res.json();

                if (!data.success) {
                    resultDiv.innerHTML = "<p>查詢失敗：" + data.error + "</p>";
                    return;
                }

                const list = data.result;
                if (list.length === 0) {
                    resultDiv.innerHTML = "<p>查無資料</p>";
                    return;
                }

                const ul = document.createElement("ul");
                list.forEach(item => {
                    const li = document.createElement("li");

                    if (type === "avg") {
                        li.textContent =
                            `#${item.rank} ${item.player_name} (${item.team_name}) - AVG: ${item.avg}`;
                    } else if (type === "era") {
                        li.textContent =
                            `#${item.rank} ${item.player_name} (${item.team_name}) - ERA: ${item.era}`;
                    } else if (type === "hr") {
                        li.textContent =
                            `#${item.rank} ${item.player_name} (${item.team_name}) - HR: ${item.total_hr}`;
                    }

                    ul.appendChild(li);
                });

                resultDiv.appendChild(ul);

            } catch (err) {
                resultDiv.innerHTML = "<p>發生錯誤：" + err + "</p>";
            }
        }

        // 預設載入打擊率
        window.onload = loadRanking;
    </script>
</body>
</html>